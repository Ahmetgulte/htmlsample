<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
    <title>Touch Pinch Zoom Image</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        #zoomable-image {
            max-width: 100%;
            max-height: 100%;
            transform-origin: center center;
            touch-action: manipulation;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <img id="zoomable-image" src="https://i.ibb.co/Kc2psngV/walkie-talkie-2.jpg" alt="Zoomable Image">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('container');
            const image = document.getElementById('zoomable-image');
            
            let currentScale = 1;
            let posX = 0;
            let posY = 0;
            let startX = 0;
            let startY = 0;
            let lastPosX = 0;
            let lastPosY = 0;
            
            // Set up Hammer.js
            const hammer = new Hammer.Manager(container);
            
            // Add recognizers
            const pinch = new Hammer.Pinch();
            const pan = new Hammer.Pan({
                direction: Hammer.DIRECTION_ALL,
                threshold: 0
            });
            const doubleTap = new Hammer.Tap({
                event: 'doubletap',
                taps: 2
            });
            
            // Add recognizers to manager
            hammer.add([pinch, pan, doubleTap]);
            
            // Ensure pan and pinch can work together
            pinch.recognizeWith(pan);
            
            // Double tap to zoom
            hammer.on('doubletap', function(e) {
                e.preventDefault();
                
                if (currentScale === 1) {
                    currentScale = 2;
                    // Center the zoom on tap position
                    const rect = container.getBoundingClientRect();
                    const centerX = (e.center.x - rect.left);
                    const centerY = (e.center.y - rect.top);
                    
                    // Adjust positioning for zoom center
                    posX = (window.innerWidth / 2 - centerX) * (currentScale - 1) / currentScale;
                    posY = (window.innerHeight / 2 - centerY) * (currentScale - 1) / currentScale;
                } else {
                    // Reset to original
                    currentScale = 1;
                    posX = 0;
                    posY = 0;
                }
                
                updateTransform();
            });
            
            // Pinch to zoom
            hammer.on('pinchstart', function(e) {
                initialScale = currentScale;
                startX = posX;
                startY = posY;
            });
            
            hammer.on('pinch', function(e) {
                // Calculate the new scale
                let newScale = Math.max(1, Math.min(5, initialScale * e.scale));
                
                // Calculate the focal point in image coordinates
                const rect = container.getBoundingClientRect();
                const centerX = (e.center.x - rect.left);
                const centerY = (e.center.y - rect.top);
                
                // Only adjust position if scaling changes
                if (newScale !== currentScale) {
                    // Adjust position to keep pinch center point stationary
                    const dx = (centerX - window.innerWidth / 2);
                    const dy = (centerY - window.innerHeight / 2);
                    
                    posX = startX - dx * (newScale - initialScale) / newScale;
                    posY = startY - dy * (newScale - initialScale) / newScale;
                    
                    currentScale = newScale;
                }
                
                updateTransform();
            });
            
            // Pan only when zoomed in
            hammer.on('panstart', function(e) {
                if (currentScale > 1) {
                    startX = posX;
                    startY = posY;
                    lastPosX = posX;
                    lastPosY = posY;
                }
            });
            
            hammer.on('pan', function(e) {
                if (currentScale > 1) {
                    // Calculate boundaries
                    const maxPosX = (currentScale - 1) * image.offsetWidth / 2;
                    const maxPosY = (currentScale - 1) * image.offsetHeight / 2;
                    
                    // Update position with delta
                    posX = Math.max(-maxPosX, Math.min(maxPosX, startX + e.deltaX));
                    posY = Math.max(-maxPosY, Math.min(maxPosY, startY + e.deltaY));
                    
                    // Inertia detection for pan
                    lastPosX = posX;
                    lastPosY = posY;
                    
                    updateTransform();
                }
            });
            
            function updateTransform() {
                image.style.transform = `translate(${posX}px, ${posY}px) scale(${currentScale})`;
            }
            
            // Prevent default browser zoom/pinch behavior
            document.addEventListener('touchmove', function(e) {
                if (currentScale !== 1 || e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Prevent contextmenu on long press
            container.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        });
    </script>
</body>
</html>
